# 日志系统使用说明

## 概述

日志系统已经修复，现在所有模块的日志都会自动保存到文件中，不再只显示在控制台。

## 主要改进

### 1. 自动文件日志
- 当调用 `setup_project_logging()` 后，所有后续创建的日志记录器都会自动将日志保存到文件
- 无需在每个模块中单独指定日志文件路径
- 保持向后兼容性，现有代码无需修改

### 2. 统一日志管理
- 项目级别的日志配置会自动应用到所有模块
- 支持统一的日志级别设置
- 所有日志都保存在同一个文件中，便于查看和分析

## 使用方法

### 基本使用

```python
from test_framework.utils.logging_system import setup_project_logging, get_logger

# 1. 在主程序中初始化项目日志系统
setup_project_logging(
    project_name='CANoe_Test_Framework',
    log_dir='logs',
    log_level='INFO'
)

# 2. 在任何模块中获取日志记录器
logger = get_logger(__name__)

# 3. 记录日志（会同时输出到控制台和文件）
logger.info("这是信息日志")
logger.warning("这是警告日志")
logger.error("这是错误日志")
```

### 高级功能

```python
from test_framework.utils.logging_system import (
    setup_project_logging,
    get_logger,
    get_project_log_file,
    get_project_log_level
)

# 获取当前项目日志文件路径
log_file = get_project_log_file()
print(f"日志文件位置: {log_file}")

# 获取当前项目日志级别
log_level = get_project_log_level()
print(f"日志级别: {log_level}")
```

## 日志文件

### 文件命名规则
- 格式：`{项目名称}_{时间戳}.log`
- 示例：`CANoe_Test_Framework_20241219_143025.log`
- 位置：`logs/` 目录下

### 日志格式
```
2024-12-19 14:30:25 - 模块名称 - 日志级别 - 日志消息
```

### 示例日志内容
```
2024-12-19 14:30:25 - CANoe_Test_Framework - INFO - 日志系统初始化完成 - 日志文件: logs/CANoe_Test_Framework_20241219_143025.log
2024-12-19 14:30:25 - CANoe_Test_Framework - INFO - 日志级别: INFO
2024-12-19 14:30:25 - CANoe_Test_Framework - INFO - 所有模块的日志将自动保存到此文件
2024-12-19 14:30:26 - test_framework.checkers.environment_checker - INFO - 开始环境检查
2024-12-19 14:30:27 - test_framework.executors.task_executor - INFO - 开始执行测试任务
```

## 配置选项

### setup_project_logging 参数

| 参数 | 类型 | 默认值 | 说明 |
|------|------|--------|------|
| project_name | str | 'CANoe_Test_Framework' | 项目名称，用于日志文件命名 |
| log_dir | str | 'logs' | 日志目录 |
| log_level | str | 'INFO' | 日志级别 |

### 支持的日志级别
- `DEBUG`: 调试信息
- `INFO`: 一般信息
- `WARNING`: 警告信息
- `ERROR`: 错误信息
- `CRITICAL`: 严重错误

## 最佳实践

### 1. 在主程序入口初始化
```python
# main.py 或 main_controller.py
from test_framework.utils.logging_system import setup_project_logging

# 在程序开始时调用一次
setup_project_logging()
```

### 2. 在每个模块中获取日志记录器
```python
# 任何模块文件
from test_framework.utils.logging_system import get_logger

# 使用模块名作为日志记录器名称
logger = get_logger(__name__)
```

### 3. 合理使用日志级别
```python
logger.debug("详细的调试信息")      # 开发调试时使用
logger.info("程序运行状态信息")      # 正常运行信息
logger.warning("可能的问题警告")     # 警告但不影响运行
logger.error("错误信息")           # 错误但程序可继续
logger.critical("严重错误")        # 严重错误，程序可能停止
```

## 故障排除

### 问题：日志只在控制台显示，不保存到文件
**解决方案：**
1. 确保在程序开始时调用了 `setup_project_logging()`
2. 检查 `logs` 目录是否有写入权限
3. 确保使用的是修复后的日志系统

### 问题：找不到日志文件
**解决方案：**
```python
from test_framework.utils.logging_system import get_project_log_file
log_file = get_project_log_file()
print(f"日志文件位置: {log_file}")
```

### 问题：日志级别不正确
**解决方案：**
```python
from test_framework.utils.logging_system import get_project_log_level
log_level = get_project_log_level()
print(f"当前日志级别: {log_level}")
```

## 测试验证

运行测试脚本验证日志系统是否正常工作：

```bash
python3 test_logging_fix.py
```

测试脚本会：
1. 初始化项目日志系统
2. 创建多个模块的日志记录器
3. 记录测试日志
4. 验证日志文件是否正确保存
5. 显示日志文件内容预览

## 注意事项

1. **只需调用一次 `setup_project_logging()`**：通常在主程序入口调用
2. **日志文件会自动创建**：包括必要的目录结构
3. **线程安全**：日志系统支持多线程环境
4. **编码支持**：日志文件使用 UTF-8 编码，支持中文
5. **性能考虑**：日志记录是异步的，不会显著影响程序性能

---

**更新日期：** 2024-12-19  
**版本：** 1.0  
**作者：** kai.ren@freetech.com